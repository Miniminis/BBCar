<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace: 필수속성! - DAO 에서 식별하기 위함! -->
<mapper namespace="com.ycha.par.dao.PaymentDao">
	
	<!-- p_idx를 통해  pr_idx조회 -->
	<select id="selectRDVByPidx" resultType="com.ycha.par.domain.RDV">
		select r_idx, dr_idx, pr_idx, r_date, rs_time, re_time, r_commute, r_startpoint, r_endpoint, r_fee, r_distance from P_RESERVATION join RDV using (pr_idx) where p_idx=#{idx};
	</select>
	
	<!-- payment 내역 DB에 insert -->
	<insert id="insertPayRecord" parameterType="com.ycha.par.domain.Payment">
		INSERT INTO PAYMENT VALUES(NULL, #{r_idx}, #{serdate}, #{sertime},  #{serdistance}, #{serprice}, #{dtime}, #{dplace}, #{atime}, #{aplace});		
	</insert>
	
	<!-- r_idx 통해서 Payment 조회 -->
	<select id="selectOneByRIdx" resultType="com.ycha.par.domain.Payment">
		select * from PAYMENT where r_idx = #{r_idx};
	</select>
	
	<!-- p_idx 통해서 payment list 조회  -->
	<select id="selectListPassenger" resultType="com.ycha.par.domain.Payment">
		select payidx, r_idx, serdate, sertime, serdistance, serprice, dtime, dplace, atime, aplace 
		from P_RESERVATION 
		join RDV using(pr_idx) 
		join PAYMENT using(r_idx) 
		where p_idx = #{p_idx};
	</select>
	
	<!-- d_idx 통해서 payment list 조회  -->
	<select id="selectListDriver" resultType="com.ycha.par.domain.Payment">
		select payidx, r_idx, serdate, sertime, serdistance, serprice, dtime, dplace, atime, aplace 
		from D_RESERVATION 
		join RDV using(dr_idx) 
		join PAYMENT using(r_idx) 
		where d_idx = #{d_idx};
	</select>
</mapper>